{% extends 'base.html' %} {% block breadcrumbs_items %}
<a href="/home/">首页</a> ⟩<a href="/platform/">{{ current_module.label }}</a> ⟩<a class="active">运行结果</a>
{% endblock %}

{% block content %}
<style type="text/css" media="screen">
#console{
  background-color: #000;
  color: #fff;
  height: 500px;
  overflow-y: auto;
}
</style>
<div class="row">
    <div class="col l10 m12">
        <div class="card">
          <div class="card-content" id="console">
          </div>
        </div>

    </div>
</div>

<div class="row">
    <div class="col l10 m12">
        <div class="card">
          <div class="card-content">
            <span class="card-title grey-text text-darken-2">Result</span>
            <div id="result">
            </div>
          </div>
        </div>

    </div>
</div>
<script type="text/javascript" charset="utf-8">
    var refreshId = window.setInterval(getLog, 1000);

    function getLog(){
        var task_id = "{{ result.id }}"
        console.log(task_id)
        $.ajax({
               type: "POST",
               url: "/tasklog/",
               data: { "task_id": task_id},
               dataType: 'json',
               success: function(data){
                    $('#console').html(data.logtext.replace(/\n/g, "<br>"));
                    $("#console").scrollTop($("#console")[0].scrollHeight);
                    if(data.state == "SUCCESS"){
                        clearInterval(refreshId);
                        $('#result').html(data.result.replace(/\n/g, '<br>'));
                    }
               }
         })

    }

</script>
{% endblock %}
